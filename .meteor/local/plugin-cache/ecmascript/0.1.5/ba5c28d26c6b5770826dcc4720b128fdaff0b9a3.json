{"metadata":{"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}},"usedHelpers":[]},"ignored":false,"code":"suiteHasFailed = function (suite) {\n  return !!VelocityTestReports.findOne({\n    framework: suite.framework,\n    ancestors: suite.ancestors,\n    result: \"failed\"\n  });\n};\n\nframeworkStatus = function (name) {\n  var hasTests = VelocityTestReports.find({ framework: name }).count() > 0;\n  if (!hasTests) return \"empty\";\n\n  var frameworkExecStatus = VelocityAggregateReports.findOne({ name: name });\n  var isComplete = frameworkExecStatus && frameworkExecStatus.result === \"completed\";\n  var hasFailed = !!VelocityTestReports.findOne({ framework: name, result: \"failed\" });\n\n  if (hasFailed) return \"failed\";else if (isComplete) return \"passed\";else return \"pending\";\n};\n\nfunction mochaPresent() {\n  //XXX hard-coding mocha iframe support for now\n  return !!VelocityAggregateReports.findOne({ 'name': 'mocha' });\n}\nfunction nightwatchPresent() {\n  return !!VelocityAggregateReports.findOne({ 'name': 'nightwatch' });\n}\nfunction cucumberPresent() {\n  return !!VelocityAggregateReports.findOne({ 'name': 'cucumber' });\n}\n\nTemplate.velocity.created = function () {\n  // Only show widget when we know we are NOT running in a Velocity Mirror\n  Session.setDefault('velocity.isMirror', true);\n  // Determine if user has disabled velocity\n  Meteor.call('velocity/isEnabled', function (error, result) {\n    if (error) {\n      // Log error. HTML Reporter will not be shown\n      console.error(error);\n    } else {\n      Session.set('velocity.isEnabled', result);\n    }\n  });\n\n  // Determine if session is running in a Velocity mirror or not\n  Meteor.call('velocity/isMirror', function (error, result) {\n    if (error) {\n      // Log error. HTML Reporter will not be shown\n      console.error(error);\n    } else {\n      Session.set('velocity.isMirror', result);\n    }\n  });\n};\n\nTemplate.velocity.helpers({\n  statusWidgetClass: function () {\n    var aggregateResult = VelocityAggregateReports.findOne({ name: 'aggregateResult' });\n    if (aggregateResult && aggregateResult.result === 'failed') {\n      return 'failed';\n    }\n\n    var aggregateComplete = VelocityAggregateReports.findOne({ name: 'aggregateComplete' });\n    if (aggregateComplete && aggregateResult && aggregateResult.result === 'passed' && aggregateComplete.result === 'completed') {\n      return 'passed';\n    }\n    return 'pending';\n  },\n  statusWidgetPosition: function () {\n    var defaultPosition = \"top right\";\n    if (Meteor.settings && Meteor.settings[\"public\"] && Meteor.settings[\"public\"]['velocity:html-reporter']) {\n      return Meteor.settings[\"public\"]['velocity:html-reporter'].position || defaultPosition;\n    }\n    return defaultPosition;\n  },\n  statusWidgetTabIndex: function () {\n    var defaultIndex = \"1\";\n    if (Meteor.settings && Meteor.settings[\"public\"] && Meteor.settings[\"public\"]['velocity:html-reporter']) {\n      return Meteor.settings[\"public\"]['velocity:html-reporter']['tab-index'] || defaultIndex;\n    }\n    return defaultIndex;\n  },\n  resetting: function () {\n    return Session.get('resettingVelocity');\n  },\n  testReports: function () {\n    return VelocityTestReports.find();\n  },\n  frameworks: function () {\n    return VelocityAggregateReports.find({ name: { $nin: [\"aggregateResult\", \"aggregateComplete\"] } });\n  },\n  active: function (id) {\n    return reamplify.store(id);\n  },\n  overlayIsVisible: function () {\n    return amplify.store('velocityOverlayIsVisible');\n  },\n  showVelocity: function () {\n    // This causes the html reporter to remain hidden if running in a Velocity mirror\n    return Session.equals('velocity.isEnabled', true) && Session.equals('velocity.isMirror', false);\n  },\n  mochaPresent: mochaPresent,\n  nightwatchPresent: nightwatchPresent\n});\n\nTemplate.velocityReports.helpers({\n  frameworkStatus: function () {\n    return frameworkStatus(this.name);\n  },\n  mirrorStatus: function () {\n    var mirror = VelocityMirrors.findOne({ framework: this.name });\n\n    return mirror && mirror.state.trim();\n  },\n  mirrorUrl: function () {\n    var mirror = VelocityMirrors.findOne({ framework: this.name });\n\n    return mirror && mirror.rootUrl;\n  },\n  isPassed: function (status) {\n    return status === 'passed';\n  },\n  frameworkTotalTestCount: function () {\n    return VelocityTestReports.find({ framework: this.name }).count();\n  },\n  frameworkPassedTestCount: function () {\n    return VelocityTestReports.find({ framework: this.name, result: 'passed' }).count();\n  },\n  noFrameworkFiles: function () {\n    // XXX presence of VelocityAggregateReports is a stand-in for\n    // Velocity being loaded. This is a bit brittle. It breaks\n    // if you call the Velocity \"reset\" method.\n    var velocityIsLoaded = !!VelocityAggregateReports;\n    return !velocityIsLoaded ? false : !VelocityTestFiles.findOne({ targetFramework: this.name });\n  },\n  suites: function () {\n    var result = [];\n    var allReports = VelocityTestReports.find({ framework: this.name }).fetch();\n    // XXX for now, ancestors get reduced to a single-tier suite\n    // Should we do fancier indenting, etc. for nested suites?\n    // If not, forcing packages to concatenate their own \"suite\" string\n    // instead of ancestors array would clean this up.\n    if (allReports.length > 0) {\n\n      var reports = _.map(allReports, function (report) {\n        //must clone report.ancestors to not mutate report.ancestors with .reverse()\n        var ancestors = report.ancestors ? _.clone(report.ancestors) : [];\n        report.suite = ancestors.reverse().join(\".\");\n        return report;\n      });\n\n      _.each(reports, function (report) {\n        if (!_.findWhere(result, { suite: report.suite })) result.push({\n          framework: report.framework,\n          ancestors: report.ancestors, //needed for future queries\n          suite: report.suite\n        });\n      });\n\n      return result;\n    }\n  },\n  suiteStatus: function () {\n    return suiteHasFailed(this) ? 'failed' : 'passed';\n  },\n  suiteNotHidden: function () {\n    if (!reamplify.store('showSuccessful')) return suiteHasFailed(this);\n    return true;\n  },\n  reports: function () {\n    return VelocityTestReports.find({\n      framework: this.framework,\n      ancestors: this.ancestors\n    });\n  }\n});\n\nTemplate.velocitySummary.helpers({\n  anyFailed: function () {\n    var aggregateResult = VelocityAggregateReports.findOne({ name: 'aggregateResult' });\n    if (aggregateResult && aggregateResult.result === 'failed') {\n      return true;\n    }\n    return false;\n  },\n  totalTime: function () {\n    var results = VelocityTestReports.find().fetch();\n\n    var firstTimeStamp, lastTimestamp, lastDuration;\n    _.each(results, function (result) {\n      if (!firstTimeStamp || firstTimeStamp > result.timestamp.getTime()) {\n        firstTimeStamp = result.timestamp.getTime();\n      }\n      if (!lastTimestamp || lastTimestamp < result.timestamp.getTime()) {\n        lastTimestamp = result.timestamp.getTime();\n        lastDuration = result.duration;\n      }\n    });\n\n    //var ms = results\n    //  .reduce(function (tot, i) { return tot + (i.duration || 0) }, 0);\n\n    var ms = lastTimestamp + lastDuration - firstTimeStamp;\n\n    if (ms >= 1000) return Math.round(ms / 1000) + ' s';\n\n    return (ms ? ms : 0) + ' ms';\n  },\n  regularPlural: function (count, word, suffix) {\n    if (count === 1) return word;\n    return word + suffix;\n  },\n  totalFailedTestCount: function () {\n    return VelocityTestReports.find({ result: 'failed' }).count();\n  },\n  totalTestCount: function () {\n    return VelocityTestReports.find().count();\n  },\n  totalPassedTestCount: function () {\n    return VelocityTestReports.find({ result: 'passed' }).count();\n  }\n});\n\nTemplate.velocityControlPanel.helpers({\n  mochaPresent: mochaPresent,\n  nightwatchPresent: nightwatchPresent,\n  cucumberPresent: cucumberPresent,\n  showActive: function (self) {\n    return reamplify.store(self) ? 'active' : '';\n  }\n});\n\nTemplate.velocityControlPanel.events({\n  'click #runNightwatchTests': function () {\n    Meteor.call('nightwatch/run');\n  },\n  'click #runCucumber': function () {\n    Meteor.call('cucumber/run');\n  }\n});\n\nTemplate.velocityTestReport.helpers({\n  reportNotHidden: function () {\n    if (this.result === \"failed\") return true;else {\n      return reamplify.store('showSuccessful');\n    }\n  },\n  failed: function () {\n    return this.result === \"failed\";\n  }\n});\n\nTemplate.velocityTestFiles.helpers({\n  testFiles: function () {\n    return VelocityTestFiles.find();\n  },\n  isVisible: function () {\n    return amplify.store('velocityTestFilesIsVisible') ? 'block' : 'none';\n  }\n});\n\nTemplate.velocityLogs.helpers({\n  logs: function () {\n    return VelocityLogs.find();\n  },\n  isVisible: function () {\n    return amplify.store('velocityLogsIsVisible') ? 'block' : 'none';\n  }\n});\n\nTemplate.velocity.events({\n  'keypress .display-toggle, click .display-toggle': function (e) {\n    var targetId = $(e.currentTarget).data('target'),\n        $target = $('#' + targetId);\n    $target.toggleClass('visible');\n    $target.attr(\"aria-hidden\", !$target.hasClass('visible'));\n    amplify.store(targetId + 'IsVisible', $target.hasClass('visible'));\n  },\n  'change input:checkbox': function (e) {\n    var targetId = e.target.id;\n    reamplify.store(e.target.id, e.target.checked);\n  },\n  'click button.control-toggle': function (e) {\n    var $target = $('#' + e.target.id);\n    $target.toggleClass('active');\n    reamplify.store(e.target.id, $target.hasClass('active'));\n  },\n  'click .velocity-options-toggle': function (e, tpl) {\n    tpl.$('.velocity-options').toggleClass('visible');\n  }\n});\n\nTemplate.velocityReports.events({\n  'click .copy-sample-tests': function (e) {\n    var self = this;\n    Meteor.call('velocity/copySampleTests', { framework: self.name }, function () {\n      // XXX This method for getting the new files to register is slow, but it\n      // works. The reset method gets Velocity to see the new files.\n      // We then disconnect altogether to prevent flapping of reactive\n      // template elements (& overlay a notification to show the user\n      // what's happening). Then we simply reload. Is there a way to do this\n      // with a lighter touch?\n\n      // make sure the user can see the demo tests, which generally pass.\n      reamplify.store('showSuccessful', true);\n      Session.set('resettingVelocity', true);\n      Meteor.call('velocity/reset', self.name);\n      Meteor.disconnect();\n      location.reload();\n    });\n  }\n});\n\nMeteor.startup(function () {\n\n  if (_.isUndefined(amplify.store('velocityOverlayIsVisible'))) {\n    amplify.store('velocityOverlayIsVisible', true);\n  }\n\n  $(document).keydown(function (e) {\n    if (e.keyCode === 86 && e.ctrlKey) {\n      var state = Session.get('velocity.isEnabled');\n      Session.set('velocity.isEnabled', !state);\n    }\n  });\n});","ast":null,"map":{"version":3,"sources":["/lib/client-report.js"],"names":[],"mappings":"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","file":"/lib/client-report.js.map","sourcesContent":["suiteHasFailed = function (suite) {\n  return !!VelocityTestReports.findOne({\n    framework: suite.framework,\n    ancestors: suite.ancestors,\n    result: \"failed\"\n  });\n};\n\nframeworkStatus = function (name) {\n  var hasTests = VelocityTestReports.find({framework: name}).count() > 0;\n  if (!hasTests) return \"empty\";\n\n  var frameworkExecStatus = VelocityAggregateReports.findOne({name: name});\n  var isComplete = (frameworkExecStatus && frameworkExecStatus.result === \"completed\");\n  var hasFailed = !!VelocityTestReports.findOne({framework: name, result: \"failed\"});\n\n  if (hasFailed)\n    return \"failed\";\n  else if (isComplete)\n    return \"passed\";\n  else\n    return \"pending\";\n};\n\nfunction mochaPresent () {\n  //XXX hard-coding mocha iframe support for now\n  return !!VelocityAggregateReports.findOne({'name': 'mocha'});\n}\nfunction nightwatchPresent () {\n  return !!VelocityAggregateReports.findOne({'name': 'nightwatch'});\n}\nfunction cucumberPresent () {\n  return !!VelocityAggregateReports.findOne({'name': 'cucumber'});\n}\n\nTemplate.velocity.created = function () {\n  // Only show widget when we know we are NOT running in a Velocity Mirror\n  Session.setDefault('velocity.isMirror', true);\n  // Determine if user has disabled velocity\n  Meteor.call('velocity/isEnabled', function (error, result) {\n    if (error) {\n      // Log error. HTML Reporter will not be shown\n      console.error(error);\n    } else {\n      Session.set('velocity.isEnabled', result);\n    }\n  });\n\n  // Determine if session is running in a Velocity mirror or not\n  Meteor.call('velocity/isMirror', function (error, result) {\n    if (error) {\n      // Log error. HTML Reporter will not be shown\n      console.error(error);\n    } else {\n      Session.set('velocity.isMirror', result);\n    }\n  })\n};\n\nTemplate.velocity.helpers({\n  statusWidgetClass: function () {\n    var aggregateResult = VelocityAggregateReports.findOne({name: 'aggregateResult'});\n    if (aggregateResult && aggregateResult.result === 'failed') {\n      return 'failed';\n    }\n\n    var aggregateComplete = VelocityAggregateReports.findOne({name: 'aggregateComplete'});\n    if (aggregateComplete && aggregateResult\n      && aggregateResult.result === 'passed' && aggregateComplete.result === 'completed') {\n      return 'passed';\n    }\n    return 'pending';\n  },\n  statusWidgetPosition: function () {\n    var defaultPosition = \"top right\";\n    if (Meteor.settings && Meteor.settings.public && Meteor.settings.public['velocity:html-reporter']) {\n      return Meteor.settings.public['velocity:html-reporter'].position || defaultPosition;\n    }\n    return defaultPosition;\n  },\n  statusWidgetTabIndex: function () {\n    var defaultIndex = \"1\";\n    if (Meteor.settings && Meteor.settings.public && Meteor.settings.public['velocity:html-reporter']) {\n      return Meteor.settings.public['velocity:html-reporter']['tab-index'] || defaultIndex;\n    }\n    return defaultIndex;\n  },\n  resetting: function () {\n    return Session.get('resettingVelocity')\n  },\n  testReports: function () {\n    return VelocityTestReports.find();\n  },\n  frameworks: function () {\n    return VelocityAggregateReports.find({name: {$nin: [\"aggregateResult\", \"aggregateComplete\"]}});\n  },\n  active: function (id) {\n    return reamplify.store(id);\n  },\n  overlayIsVisible: function () {\n    return amplify.store('velocityOverlayIsVisible')\n  },\n  showVelocity: function () {\n    // This causes the html reporter to remain hidden if running in a Velocity mirror\n    return Session.equals('velocity.isEnabled', true) && Session.equals('velocity.isMirror', false);\n  },\n  mochaPresent: mochaPresent,\n  nightwatchPresent: nightwatchPresent\n});\n\nTemplate.velocityReports.helpers({\n  frameworkStatus: function () {\n    return frameworkStatus(this.name)\n  },\n  mirrorStatus: function () {\n    var mirror = VelocityMirrors.findOne({framework: this.name});\n\n    return mirror && mirror.state.trim();\n  },\n  mirrorUrl: function () {\n    var mirror = VelocityMirrors.findOne({framework: this.name});\n\n    return mirror && mirror.rootUrl;\n  },\n  isPassed: function (status) {\n    return status === 'passed'\n  },\n  frameworkTotalTestCount: function () {\n    return VelocityTestReports.find({framework: this.name}).count();\n  },\n  frameworkPassedTestCount: function () {\n    return VelocityTestReports.find({framework: this.name, result: 'passed'}).count();\n  },\n  noFrameworkFiles: function () {\n    // XXX presence of VelocityAggregateReports is a stand-in for\n    // Velocity being loaded. This is a bit brittle. It breaks\n    // if you call the Velocity \"reset\" method.\n    var velocityIsLoaded = !!VelocityAggregateReports;\n    return !velocityIsLoaded ? false : !VelocityTestFiles.findOne({targetFramework: this.name});\n  },\n  suites: function () {\n    var result = [];\n    var allReports = VelocityTestReports.find({framework: this.name}).fetch();\n    // XXX for now, ancestors get reduced to a single-tier suite\n    // Should we do fancier indenting, etc. for nested suites?\n    // If not, forcing packages to concatenate their own \"suite\" string\n    // instead of ancestors array would clean this up.\n    if (allReports.length > 0) {\n\n      var reports = _.map(allReports, function (report) {\n        //must clone report.ancestors to not mutate report.ancestors with .reverse()\n        var ancestors = report.ancestors ? _.clone(report.ancestors) : [];\n        report.suite = ancestors.reverse().join(\".\");\n        return report;\n      });\n\n      _.each(reports, function (report) {\n        if (!_.findWhere(result, {suite: report.suite}))\n          result.push({\n            framework: report.framework,\n            ancestors: report.ancestors, //needed for future queries\n            suite: report.suite\n          })\n      });\n\n      return result;\n    }\n  },\n  suiteStatus: function () {\n    return suiteHasFailed(this) ? 'failed' : 'passed';\n  },\n  suiteNotHidden: function () {\n    if (!reamplify.store('showSuccessful'))\n      return suiteHasFailed(this);\n    return true;\n  },\n  reports: function () {\n    return VelocityTestReports.find({\n      framework: this.framework,\n      ancestors: this.ancestors\n    });\n  }\n});\n\nTemplate.velocitySummary.helpers({\n  anyFailed: function () {\n    var aggregateResult = VelocityAggregateReports.findOne({name: 'aggregateResult'});\n    if (aggregateResult && aggregateResult.result === 'failed') {\n      return true;\n    }\n    return false;\n  },\n  totalTime: function () {\n    var results = VelocityTestReports.find().fetch();\n\n    var firstTimeStamp, lastTimestamp, lastDuration;\n    _.each(results, function (result) {\n      if (!firstTimeStamp || firstTimeStamp > result.timestamp.getTime()) {\n        firstTimeStamp = result.timestamp.getTime();\n      }\n      if (!lastTimestamp || lastTimestamp < result.timestamp.getTime()) {\n        lastTimestamp = result.timestamp.getTime();\n        lastDuration = result.duration;\n      }\n    });\n\n    //var ms = results\n    //  .reduce(function (tot, i) { return tot + (i.duration || 0) }, 0);\n\n    var ms = lastTimestamp + lastDuration - firstTimeStamp;\n\n    if (ms >= 1000) return Math.round(ms / 1000) + ' s';\n\n    return (ms ? ms : 0) + ' ms';\n  },\n  regularPlural: function (count, word, suffix) {\n    if (count === 1) return word;\n    return word + suffix;\n  },\n  totalFailedTestCount: function () {\n    return VelocityTestReports.find({result: 'failed'}).count();\n  },\n  totalTestCount: function () {\n    return VelocityTestReports.find().count();\n  },\n  totalPassedTestCount: function () {\n    return VelocityTestReports.find({result: 'passed'}).count();\n  }\n});\n\nTemplate.velocityControlPanel.helpers({\n  mochaPresent: mochaPresent,\n  nightwatchPresent: nightwatchPresent,\n  cucumberPresent: cucumberPresent,\n  showActive: function (self) {\n    return reamplify.store(self) ? 'active' : ''\n  }\n});\n\nTemplate.velocityControlPanel.events({\n  'click #runNightwatchTests': function () {\n    Meteor.call('nightwatch/run');\n  },\n  'click #runCucumber': function () {\n    Meteor.call('cucumber/run');\n  }\n});\n\nTemplate.velocityTestReport.helpers({\n  reportNotHidden: function () {\n    if (this.result === \"failed\")\n      return true;\n    else {\n      return (reamplify.store('showSuccessful'));\n    }\n  },\n  failed: function () {\n    return (this.result === \"failed\");\n  }\n});\n\nTemplate.velocityTestFiles.helpers({\n  testFiles: function () {\n    return VelocityTestFiles.find();\n  },\n  isVisible: function () {\n    return amplify.store('velocityTestFilesIsVisible') ? 'block' : 'none';\n  }\n});\n\nTemplate.velocityLogs.helpers({\n  logs: function () {\n    return VelocityLogs.find();\n  },\n  isVisible: function () {\n    return amplify.store('velocityLogsIsVisible') ? 'block' : 'none';\n  }\n});\n\nTemplate.velocity.events({\n  'keypress .display-toggle, click .display-toggle': function (e) {\n    var targetId = $(e.currentTarget).data('target'),\n        $target = $('#' + targetId);\n    $target.toggleClass('visible');\n    $target.attr(\"aria-hidden\", !$target.hasClass('visible'));\n    amplify.store(targetId + 'IsVisible', $target.hasClass('visible'));\n  },\n  'change input:checkbox': function (e) {\n    var targetId = e.target.id;\n    reamplify.store(e.target.id, e.target.checked);\n  },\n  'click button.control-toggle': function (e) {\n    var $target = $('#' + e.target.id);\n    $target.toggleClass('active');\n    reamplify.store(e.target.id, $target.hasClass('active'));\n  },\n  'click .velocity-options-toggle': function (e, tpl) {\n    tpl.$('.velocity-options').toggleClass('visible')\n  }\n});\n\nTemplate.velocityReports.events({\n  'click .copy-sample-tests': function (e) {\n    var self = this;\n    Meteor.call('velocity/copySampleTests', {framework: self.name}, function () {\n      // XXX This method for getting the new files to register is slow, but it\n      // works. The reset method gets Velocity to see the new files.\n      // We then disconnect altogether to prevent flapping of reactive\n      // template elements (& overlay a notification to show the user\n      // what's happening). Then we simply reload. Is there a way to do this\n      // with a lighter touch?\n\n      // make sure the user can see the demo tests, which generally pass.\n      reamplify.store('showSuccessful', true);\n      Session.set('resettingVelocity', true);\n      Meteor.call('velocity/reset', self.name);\n      Meteor.disconnect();\n      location.reload();\n    });\n  }\n});\n\nMeteor.startup(function () {\n\n  if (_.isUndefined(amplify.store('velocityOverlayIsVisible'))) {\n    amplify.store('velocityOverlayIsVisible', true);\n  }\n\n  $(document).keydown(function (e) {\n    if (e.keyCode === 86 && e.ctrlKey) {\n      var state = Session.get('velocity.isEnabled');\n      Session.set('velocity.isEnabled', !state);\n    }\n  });\n\n});\n"]},"hash":"ba5c28d26c6b5770826dcc4720b128fdaff0b9a3"}
